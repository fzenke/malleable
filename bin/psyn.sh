#!/bin/sh

# Plots syn files generated by Auryn's WeightMonitor class.

if [ "$1" != "" ]; then
	FILE=$1
else
	FILE=`ls -tr1 *.syn | tail -n 1`
fi

if [ "$2" != "" ]; then
	N=$2
else
	N=20
fi

BASENAME=`basename $FILE`

echo "Plotting $BASENAME"

cat << __EOF | gnuplot -p 
set title '$BASENAME'
set xlabel 'Time [s]'
set ylabel 'Synaptic weight'
plot for [i=2:$N+1] '$FILE' every 2 using 1:i w l lc -1 title '', "< awk '{ if (NR%10!=0) skip; sum =0; for (i=2 ; i < NF ; ++i) {sum+=\$i} ; if (fields!=NF) {fields=NF} else { print \$1 \" \" sum/(NF-2) ; } }' $FILE" with lines lc 1 lw 2 title 'mean'
__EOF
